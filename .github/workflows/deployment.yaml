name: Deployment
on: 
    pull_request:
        types: [opened, reopened]
jobs:
    artifact:
        name: Publish - GitHub Packages
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
            - name: Set up JDK 11
              uses: actions/setup-java@v3
              with:
                distribution: 'temurin'
                java-version: 11
            # - name: Bump pom versions
            #   run: |
            #     python -m pip install --upgrade pip
            #     pip install -r requirements.txt
            #     python readpom.py
            - name: Publish artifact on GitHub Packages
              run: mvn -B clean deploy -DskipTests
              env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    docker:
        name: Publish - Docker Hub
        runs-on: ubuntu-latest
        env:
          REPO: ${{ secrets.DOCKER_REPO }}
        steps:
        - uses: actions/checkout@v1
        - name: Login to Docker Hub
          run: docker login -u ${{ secrets.DOCKER_USER }} -p ${{ secrets.DOCKER_PASS }}
        - name: Build Docker image
          run: docker build -t $REPO:latest -t $REPO:${GITHUB_SHA::8} .
        - name: Publish Docker image
          run: docker push $REPO
